<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDoListDapp</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <!-- App banner-->
  <section class="py-4 py-xl-5">
      <div class="container">
          <div class="text-white bg-dark border rounded border-0 p-4 p-md-5">
              <h2 class="fw-bold text-white mb-3">To-Do List Decentralized Application</h2>
              <p class="mb-4"><i>created by gparap</i></p>
              <div class="my-3">
                  <!-- <a class="btn btn-primary btn-lg me-2" role="button" href="#">Button</a> -->
                  <a class="btn btn-light btn-lg" role="button" href="#">Add To-Do</a>
              </div>
              <h6 id="todos-count" "fw-bold text-white mb-3">total: </h6>
          </div>
      </div>
  </section>

  <!-- To-Do container -->
  <section>
    <div class="container">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">To-Do</th>
            <th scope="col">Date</th>
            <th scope="col">Status</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1</th>
            <td>Finish Dapp</td>
            <td>today</td>
            <td>pending...</td>
            <td><button type="button" class="btn btn-light">Delete</button></td>
          </tr>
          <tr>
            <th scope="row">2</th>
            <td>Finish Dapp</td>
            <td>today</td>
            <td>completed</td>
            <td><button type="button" class="btn btn-light">Delete</button></td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <script>
    //connect to an Ethereum RPC client
    const provider = new ethers.providers.JsonRpcProvider();
  
    //set the contract address
    const contractAddress = "0x1f7Ab6c7413d006D3427F7D33a84970ffD77f757";

    //set the contract interface
    const contractABI = [
    {
          "inputs": [],
          "stateMutability": "nonpayable",
          "type": "constructor"
        },
        {
          "inputs": [
            {
              "internalType": "string",
              "name": "_name",
              "type": "string"
            },
            {
              "internalType": "string",
              "name": "_details",
              "type": "string"
            }
          ],
          "name": "createToDo",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "_id",
              "type": "uint256"
            }
          ],
          "name": "deleteToDo",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "_id",
              "type": "uint256"
            }
          ],
          "name": "getToDo",
          "outputs": [
            {
              "components": [
                {
                  "internalType": "uint256",
                  "name": "id",
                  "type": "uint256"
                },
                {
                  "internalType": "string",
                  "name": "name",
                  "type": "string"
                },
                {
                  "internalType": "string",
                  "name": "details",
                  "type": "string"
                },
                {
                  "internalType": "uint256",
                  "name": "date",
                  "type": "uint256"
                },
                {
                  "internalType": "bool",
                  "name": "isCompleted",
                  "type": "bool"
                }
              ],
              "internalType": "struct ToDoContract.ToDo",
              "name": "",
              "type": "tuple"
            }
          ],
          "stateMutability": "view",
          "type": "function",
          "constant": true
        },
        {
          "inputs": [],
          "name": "getToDosCount",
          "outputs": [
            {
              "internalType": "uint256",
              "name": "",
              "type": "uint256"
            }
          ],
          "stateMutability": "view",
          "type": "function",
          "constant": true
        },
        {
          "inputs": [
            {
              "internalType": "uint256",
              "name": "_id",
              "type": "uint256"
            },
            {
              "internalType": "bool",
              "name": "_isCompleted",
              "type": "bool"
            }
          ],
          "name": "setCompleted",
          "outputs": [],
          "stateMutability": "nonpayable",
          "type": "function"
        }
    ];
          
    //create contract
    const contract = new ethers.Contract(contractAddress, contractABI, provider);   
        
    //get the account signer
    const signer = provider.getSigner();

    //connect contract to the account signer for performing state-changing transactions
    const contractWithSigner = contract.connect(signer);

    //get the number of all the todos stored in the blockchain
    function getToDosCount() {
      contract.getToDosCount().then((count)=>{
        var element = document.getElementById("todos-count");
        element.innerHTML += + count;
      });
    }
    getToDosCount();

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>